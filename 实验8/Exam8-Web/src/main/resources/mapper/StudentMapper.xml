<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.sdju.soft.dao.StudentMapper">

    <insert id="insertStudent" parameterType="cn.edu.sdju.soft.bean.Student" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_student (stu_name, major, dormitory)
        VALUES (#{stuName}, #{major}, #{dormitory})
    </insert>

    <select id="selectAllStudents" resultType="cn.edu.sdju.soft.bean.Student">
        SELECT id,stu_name,major,dormitory FROM tb_student
    </select>

    <select id="getStuCourse" parameterType="int" resultMap="getStuCourseResultMap">
        select s.id as stu_id, s.stu_name, s.major, s.dormitory, c.id as course_id, c.course_name
        from tb_student s
        left join tb_stu_course sc on s.id = sc.stuId
        left join tb_course c on sc.courseId = c.id
        where s.id = #{stuNo}
    </select>

    <resultMap id="getStuCourseResultMap" type="cn.edu.sdju.soft.bean.StudentWithCourse">
        <id property="id" column="stu_id" />
        <result property="stuName" column="stu_name" />
        <result property="major" column="major" />
        <result property="dormitory" column="dormitory" />

        <collection property="courses" ofType="cn.edu.sdju.soft.bean.Course">
            <id property="id" column="course_id" />
            <result property="courseName" column="course_name" />
        </collection>
    </resultMap>

</mapper>